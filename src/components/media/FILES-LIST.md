# Управление добавленными файлами

## Основные концепции

## StatusBar (Статус бар)

### Динамическое отображение дат

- При добавлении файлов за определенную дату:
  - Пункт с добавленной датой исчезает
  - Нижние пункты перемещаются вверх
  - Появляется новый пункт с следующей датой по количеству файлов
- Сортировка дат происходит по количеству файлов
- Всегда отображаются максимум 2 даты с наибольшим количеством файлов
- При добавлении всех файлов за дату происходит автоматическое обновление списка

### Основные действия

1. Добавление по типу:
   - Все видео файлы
   - Все аудио файлы
   - Последовательные серии

2. Добавление по дате:
   - Динамический список из 2-х дат
   - Автоматическое обновление при добавлении
   - Сортировка по количеству файлов

3. Общие действия:
   - Добавление всех файлов
   - Обновление списка

### Хранение состояния

- Используется Set для хранения ID добавленных файлов
- Состояние `addedFiles` хранится в компоненте MediaFilesList
- При добавлении файлов ID сохраняются в Set для быстрого поиска

### Методы добавления файлов

#### 1. Добавление одного файла

````typescript
const handleAddMedia = (e: React.MouseEvent, file: MediaFile) => {
const fileId = getFileId(file)
if (addedFiles.has(fileId)) return // Проверка на дубликаты
addNewTracks([file])
setAddedFiles(prev => new Set([...prev, fileId]))
}```


#### 2. Добавление файлов по дате

```typescript
const handleAddDateFiles = (targetDate: string) => {
const dateFiles = media.filter(file => {
if (!file.startTime) return false
const fileDate = new Date(file.startTime 1000)
.toLocaleDateString("ru-RU", {
day: "2-digit",
month: "long",
year: "numeric"
})
return fileDate === targetDate
})
addNewTracks(dateFiles)
setAddedFiles(prev => new Set([...prev, ...dateFiles.map(getFileId)]))
}```

#### 3. Добавление последовательных файлов

```typescript
const handleAddSequentialFiles = () => {
if (!sequentialFiles) return
addNewTracks(sequentialFiles)
setAddedFiles(prev => new Set([...prev, ...sequentialFiles.map(getFileId)]))
}```

### Проверки при добавлении

1. **Проверка на дубликаты**
   - Перед добавлением проверяется наличие файла в Set
   - Если файл уже добавлен, операция пропускается

2. **Валидация типа файла**
   - Проверяется наличие видеопотока
   - Проверяется корректность метаданных

3. **Проверка последовательности**
   - При добавлении последовательных файлов проверяется их связность
   - Учитывается временная последовательность

### Визуальная индикация

1. **Состояние добавленных файлов**
   - Добавленные файлы отображаются с пониженной прозрачностью
   - Кнопки добавления блокируются
   - Добавляется класс `pointer-events-none`

2. **Группировка по дате**
   - Файлы группируются по дате создания
   - Отображается количество файлов в каждой группе
   - Возможность добавления всех файлов за определенную дату

### Обработка ошибок

1. **Отсутствие метаданных**
   - Проверка наличия необходимых полей
   - Fallback значения для отсутствующих данных

2. **Некорректные данные**
   - Валидация временных меток
   - Проверка целостности последовательностей

### Оптимизация

1. **Производительность**
   - Использование Set для быстрого поиска
   - Мемоизация вычисляемых значений
   - Эффективное обновление состояния

2. **Память**
   - Хранение только необходимых ID
   - Очистка неиспользуемых ресурсов
````
