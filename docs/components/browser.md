# Browser (Браузер медиафайлов)

## Обзор

Браузер медиафайлов — это компонент, отвечающий за отображение, управление и добавление медиафайлов на таймлайн. Он позволяет просматривать доступные медиафайлы, сортировать и фильтровать их, а также добавлять на таймлайн для монтажа.

## Состояние

Браузер управляется через машину состояний `mediaMachine`, которая контролирует:

- Загрузку и отображение файлов
- Фильтрацию и сортировку
- Выбор активного файла
- Предпросмотр файлов
- Добавление файлов на таймлайн

## Основные функции

- Добавление файлов
- Отображение файлов
- Управление вкладками (Медиатека, Музыка, Переходы, Эффекты, Фильтры, Стикеры, Шаблоны)
- Навигация по медиатеке
- Просмотр видео и прослушивание аудио
- Сортировка, фильтрация, группировка
- Отображение метаданных файлов
- Добавление файлов на таймлайн
- Запись с камеры, экрана ПК и голоса

## Структура компонентов

### Основные компоненты

- `browser/components/` - основные компоненты браузера
  - `browser.tsx` - корневой компонент
  - `layout/` - компоненты макета
    - `add-media-button.tsx` - кнопка добавления медиа
    - `audio-player.tsx` - аудиоплеер
    - `no-files.tsx` - компонент для отображения пустого состояния
    - `status-bar.tsx` - статусная строка
  - `preview/` - компоненты предпросмотра
    - `media-preview.tsx` - общий компонент предпросмотра
    - `video-preview.tsx` - предпросмотр видео
    - `audio-preview.tsx` - предпросмотр аудио
    - `image-preview.tsx` - предпросмотр изображений
    - `preview-timeline.tsx` - временная шкала для предпросмотра
  - `tabs/` - компоненты вкладок
    - `media/` - вкладка медиатеки
      - `media-list.tsx` - список медиафайлов
      - `file-metadata.tsx` - метаданные файла
      - `media-toolbar.tsx` - панель инструментов медиатеки
    - `music/` - вкладка музыки
      - `music-file-list.tsx` - список аудиофайлов
      - `music-toolbar.tsx` - панель инструментов музыки
    - `transitions/` - вкладка переходов
      - `transition-list.tsx` - список переходов
    - `effects/` - вкладка эффектов
      - `effect-list.tsx` - список эффектов
    - `filters/` - вкладка фильтров
      - `filter-list.tsx` - список фильтров
    - `stickers/` - вкладка стикеров
      - `sticker-list.tsx` - список стикеров
    - `subtitles/` - вкладка субтитров
      - `subtitle-list.tsx` - список субтитров
    - `templates/` - вкладка шаблонов
      - `template-list.tsx` - список шаблонов
      - `template-list-toolbar.tsx` - панель инструментов шаблонов

### Дополнительные компоненты

- `dialogs/components/` - компоненты диалогов
  - `camera-recording.tsx` - запись с камеры

### Файлы состояния

- `browser/machines/` - машины состояний
  - `media-machine.ts` - машина состояний для медиафайлов
  - `user-settings-machine.ts` - машина состояний для пользовательских настроек
- `browser/providers/` - провайдеры контекста
  - `media-provider.tsx` - провайдер контекста медиафайлов
  - `user-settings-provider.tsx` - провайдер контекста пользовательских настроек
- `browser/contexts/` - контексты
  - `use-media.ts` - хук для доступа к контексту медиафайлов

## Поддерживаемые типы файлов

- **Видео**: `.mp4`, `.mov`, `.avi`, `.mkv`, `.webm`
- **Аудио**: `.mp3`, `.wav`, `.aac`, `.ogg`, `.flac`
- **Изображения**: `.jpg`, `.jpeg`, `.png`, `.gif`, `.webp`, `.heic`
- **Субтитры**: `.srt`, `.vtt`
- **Эффекты**: `.json` (пресеты)
- **Переходы**: `.json` (пресеты)
- **Фильтры**: `.json` (пресеты)
- **Стикеры**: `.png`, `.svg`

## Функциональность сортировки и фильтрации

### Сортировка

- По имени (A-Z, Z-A)
- По дате создания (новые-старые, старые-новые)
- По размеру файла
- По длительности

### Фильтрация

- Все файлы
- Видео
- Аудио
- Изображения

### Группировка

- Без группировки
- По типу файла (видео/аудио/изображения)
- По дате создания
- По длительности

### Поиск

- Поиск по имени файла
- Поиск по тегам
- Поиск по метаданным
- Фильтрация результатов поиска
- Сохранение поисковых запросов
- Быстрый поиск (по мере ввода)

## Управление метаданными

- Просмотр метаданных файла
- Редактирование тегов
- Добавление описаний
- Управление рейтингами
- Добавление заметок
- Экспорт метаданных

## Взаимодействие с другими компонентами

### Взаимодействие с таймлайном

- Добавление медиафайлов на таймлайн
- Синхронизация выбранных файлов
- Обновление метаданных при изменении файлов

### Взаимодействие с плеером

- Предпросмотр медиафайлов
- Синхронизация воспроизведения
- Управление громкостью

## Примеры использования

### Добавление файла на таймлайн

```typescript
// В компоненте браузера
const { addToTimeline } = useTimeline()
const { selectedMedia } = useMedia()

const handleAddToTimeline = () => {
  if (selectedMedia) {
    addToTimeline(selectedMedia)
  }
}
```

### Фильтрация файлов

```typescript
// В компоненте браузера
const { filterMedia } = useMedia()

const handleFilterChange = (filter: string) => {
  filterMedia(filter)
}
```

## Планы по развитию

- Реализация запись экрана ПК (создать компонент `screen-recording.tsx`)
- Реализация записи голоса (создать компонент `audio-recording.tsx`)
- Проработка механизма добавления/переноса эффектов, фильтров и переходов на таймлайн
- Разработка системы добавления шаблонов на объединенный схема-таймлайн
- Реализация синхронизации настроек предпросмотра между вкладками
- Добавление возможности группировки шаблонов по количеству экранов

## Связанные документы

- [Обзор архитектуры](../architecture/overview.md)
- [Машины состояний](../architecture/state-machines.md)
- [Руководство пользователя по браузеру](../user-guide/browser.md)
