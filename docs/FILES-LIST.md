# Списки

## Компоненты

### MediaFilesList
Компонент для отображения списка медиафайлов с возможностью предпросмотра и управления воспроизведением.

#### Основной функционал:
- Отображение списка видео и аудио файлов с метаданными
- Предпросмотр видео при наведении курсора
- Воспроизведение с выбранной позиции
- Добавление файлов в треки
- Визуальная временная шкала

#### Особенности реализации:
1. **Предпросмотр времени**
   - При наведении курсора на миниатюру отображается красная линия-индикатор
   - Над линией показывается точное время в формате ЧЧ:ММ:СС
   - Видео автоматически перематывается на соответствующую позицию
   - Работает как для видео, так и для аудио файлов

2. **Управление воспроизведением**
   - Кнопка play/pause появляется при наведении на миниатюру
   - При нажатии воспроизведение начинается с текущей позиции курсора
   - Поддерживается циклическое воспроизведение (loop)

3. **Работа с треками**
   - Каждый файл можно добавить в трек
   - Поддерживается группировка файлов по одинковым камерам
   - Возможность добавления всех файлов в треки одним действием
   - Автоматический расчет временных диапазонов при добавлении

4. **Отображение метаданных**
   - Название файла
   - Размер файла
   - Разрешение видео
   - Длительность
   - Дата и время создания
   - Тип кодека

#### Технические детали:

```typescript
interface MediaFile {
  id: string
  name: string
  path: string
  thumbnail?: string
  isVideo: boolean
  probeData?: {
    format: {
      duration: number
      size: number
      creation_time: number
    }
    streams: Array<{
      codec_type: string
      width?: number
      height?: number
      codec_name?: string
    }>
  }
}
```

#### Состояния компонента:
- `playingFileId`: ID текущего воспроизводимого файла
- `hoverTimes`: временные метки при наведении для каждого файла
- `videoRefs`: ссылки на HTML элементы видео/аудио
- `tracks`: массив созданных треков

#### Обработка событий:
- `handleMouseMove`: расчет времени по позиции курсора
- `handlePlayPause`: управление воспроизведением
- `handleAddToTrack`: добавление файла в новый трек
- `handleAddAllFiles`: группировка и добавление всех файлов в треки

## Принцип работы

### Инициализация компонента
1. При монтировании компонент получает список медиафайлов через хук `useMedia`
2. Для каждого файла создаются ref-ссылки для управления воспроизведением
3. Инициализируются состояния для отслеживания воспроизведения и временных меток

### Предпросмотр при наведении
1. При наведении курсора на миниатюру:
   - Вычисляется позиция курсора относительно ширины миниатюры
   - Рассчитывается соответствующее время видео
   - Обновляется состояние `hoverTimes` для конкретного файла
   - Видео/аудио перематывается на расчетную позицию
   - Отображается временная линия и метка времени

2. Временная линия:
   - Красная вертикальная полоса показывает текущую позицию
   - Над полосой отображается точное время
   - Положение обновляется в реальном времени при движении курсора
   - При выходе за пределы миниатюры индикаторы скрываются

### Воспроизведение
1. При нажатии на кнопку play:
   - Если есть активная временная метка, воспроизведение начинается с неё
   - Иначе воспроизведение начинается с начала файла
   - Обновляется `playingFileId`
   - Файл воспроизводится в цикле (loop)

2. При нажатии на pause:
   - Воспроизведение останавливается
   - `playingFileId` сбрасывается
   - Сохраняется текущая позиция воспроизведения

### Добавление в треки
1. Добавление одного файла:
   - Создается новый трек с уникальным ID
   - Рассчитывается временной диапазон
   - Трек добавляется в общий список треков
   - Проверяется уникальность добавления

2. Добавление всех файлов:
   - Файлы группируются по камерам
   - Для каждой группы создается отдельный трек
   - Рассчитываются общие временные диапазоны
   - Все треки добавляются в список одновременно

### Оптимизация
- Предварительная загрузка видео через `preload="auto"`
- Использование `ref` для прямого доступа к элементам медиа
- Кэширование расчетов временных диапазонов
- Отложенная загрузка миниатюр
- Эффективное обновление состояний для плавной анимации

### Обработка ошибок
- Проверка корректности временных меток
- Валидация позиции курсора
- Обработка отсутствующих миниатюр
- Fallback для неподдерживаемых форматов
