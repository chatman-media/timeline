# Приложение Timeline Editor: Обзор и Сценарии Использования

## Введение

Timeline Editor - это приложение для видеомонтажа, ориентированное на производительность и удобство работы, особенно при работе с несколькими источниками видео (например, с нескольких камер).

Ключевой особенностью является возможность работы с несколькими синхронизированными видеодорожками, предпросмотр в реальном времени и гибкая настройка рабочего пространства. В будущем планируется добавление программируемых сценариев монтажа для автоматизации рутинных задач.

## Основная концепция рабочего процесса

1.  **Импорт медиа:** Пользователь добавляет видео и аудио файлы в медиа-браузер.
2.  **Организация треков:** Файлы автоматически или вручную организуются в треки (дорожки) на таймлайне. Часто предполагается, что каждый трек соответствует одной камере или источнику.
3.  **Монтаж на таймлайне:** Пользователь просматривает материал, переключается между активными треками (камерами) для выбора нужного ракурса в конкретный момент времени.
4.  **Настройка:** Пользователь настраивает переходы, эффекты (в будущем), громкость, макет отображения.
5.  **Предпросмотр:** Результат можно просмотреть в реальном времени в окне плеера.
6.  **Сохранение:** Состояние проекта автоматически сохраняется, позволяя продолжить работу позже.
7.  **Экспорт:** (В будущем) Экспорт готового видео.

## Ключевые Возможности

### 1. Управление Медиафайлами

- **Импорт:** Добавление видео и аудио файлов.
- **Поддерживаемые форматы:** MP4, MOV, AVI, MKV, WEBM, (аудио: MP3, WAV, AAC, OGG, FLAC), поддержка 360° видео (INSV).
- **Медиа-браузер:** Отображение списка добавленных файлов, их метаданных (длительность, формат).
- **Предпросмотр:** Возможность быстрого просмотра файлов.
- **Метаданные:** Автоматическое чтение и отображение метаданных с помощью `ffprobe` (на стороне сервера).

### 2. Таймлайн и Воспроизведение

- **Визуализация:** Отображение всех треков на временной шкале.
- **Миниатюры:** Генерация и кэширование миниатюр для видео на таймлайне для удобной навигации.
- **Навигация:** Перемещение по таймлайну (скролл, клик), масштабирование.
- **Воспроизведение:** Плавное воспроизведение таймлайна (~60fps) с синхронизацией активного видео.
- **Управление воспроизведением:** Play/Pause (Пробел, P).
- **Активное видео:** Отображение выбранного видео (или нескольких видео в зависимости от макета) в основном плеере.

### 3. Треки и Редактирование

- **Треки (Дорожки):** Автоматическое или ручное создание треков. Группировка видео (например, по камере или дате).
- **Активный трек/камера:** Переключение между треками (клавиши 1-9) для выбора основного видео в плеере.
- **Синхронизация:** Видео на разных треках синхронизированы по времени (предполагается использование времени создания файла или других метаданных).
- **Громкость:** Управление общей громкостью и громкостью отдельных треков.

### 4. Пользовательский Интерфейс и Взаимодействие

- **Макеты Экрана (Layouts):** Выбор режима отображения плеера и панелей:
  - Default
  - Classic
  - Vertical
  - Dual (для внешних дисплеев)
- **Настройка панелей:** Возможность изменять размеры панелей интерфейса.
- **Горячие клавиши:** Использование клавиатуры для навигации и управления (переключение камер, play/pause).

### 5. Управление Состоянием и Персистентность

- **Централизованное состояние:** Использование `XState Store` (`rootStore`) для управления состоянием всего приложения.
- **Автосохранение:** Текущее состояние проекта (треки, активные видео, настройки UI и т.д.) автоматически сохраняется в `IndexedDB` (с использованием `Dexie.js`).
- **Восстановление состояния:** При запуске приложения последнее сохраненное состояние автоматически загружается из `IndexedDB`.
- **История действий (Undo/Redo):**
  - Реализована на основе снимков состояния (state snapshots).
  - Значимые изменения (смена трека, добавление файлов, изменение макета и т.д.) создают новую точку в истории.
  - Возможность отмены (Ctrl+Z/Cmd+Z) и повтора (Ctrl+Y/Cmd+Y) действий.

### 6. Производительность и Оптимизация

- **Кэширование миниатюр:** Сгенерированные миниатюры кэшируются для быстрого отображения при повторном доступе.
- **Оптимизация запросов:** Управление асинхронными запросами (например, для миниатюр) для предотвращения излишней нагрузки.
- **Эффективное обновление UI:** Использование `XState Store` позволяет обновлять только те части интерфейса, которые зависят от изменившихся данных.

### 7. Будущие Возможности (TODO)

- **Эффекты:** Применение визуальных эффектов к видео.
- **Переходы:** Добавление и настройка переходов между клипами.
- **Шаблоны/Сценарии:** Использование предопределенных или программируемых сценариев монтажа.
- **Экспорт:** Экспорт готового видео в выбранном формате.

## Горячие Клавиши

- **1-9:** Переключение на активный трек/камеру 1-9.
- **Пробел:** Воспроизведение / Пауза.
- **P / p:** Воспроизведение / Пауза.

## Roadmap / Ближайшие планы

- **Углубленные сценарии работы с дорожками:**
  - Ручное добавление/удаление дорожек.
  - Переименование дорожек.
  - Изменение порядка дорожек.
  - Объединение/разделение дорожек.
  - Группировка/разгруппировка дорожек.
  - Назначение ролей/меток дорожкам (основной звук, B-roll и т.д.).
  - Визуальное редактирование сегментов внутри дорожки (обрезка, перемещение).
  - Более гибкие настройки автоматической синхронизации.
- **Интеграция YOLO:**
  - Подключение модели YOLO для детекции объектов в видео.
  - Визуализация обнаруженных объектов (например, bounding boxes) на таймлайне/дорожках.
  - Возможность фильтрации/поиска по обнаруженным объектам.
- **Реализация TODO из раздела "Будущие Возможности".**
- **Улучшение производительности при большом количестве треков/файлов.**
- **Расширение поддержки форматов.**
